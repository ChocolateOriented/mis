<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mo9.risk.modules.dunning.sendMessage.dao.MessageEntityDao">
    <sql id="messageEntityColumns">
        a.id AS "id",
        a.messageId AS "messageId",
        a.messageKey AS "messageKey",
        a.topic AS "topic",
        a.tag AS "tag",
        a.message AS "message",
        a.status AS "status",
        a.times AS "times",
        a.nextSendTime AS "nextSendTime"
    </sql>

    <select id="get" resultType="MessageEntity" useCache="false">
        SELECT
        <include refid="MessageEntityColumns"/>
        FROM message_entity a
        WHERE a.id = #{id}
    </select>

    <select id="getResendMessages" resultType="MessageEntity" useCache="false">
        SELECT
        <include refid="MessageEntityColumns"/>
        FROM message_entity a
    </select>

    <update id="updateMessage">
        UPDATE message_entity SET
        <include refid="MessageEntityColumns"/>
        WHERE id = #{id}
    </update>

    <select id="generateNextSendTime" resultType="MessageEntity" useCache="false">
        SELECT
              a.`nextSendTime`,
              a.`times`
        FROM message_entity a
        WHERE id = #{id}
    </select>

    <insert id="insert">
        INSERT INTO message_entity(
              id,
              messageId,
              messageKey,
              topic,
              tag,
              message,
              status,
              times,
              nextSendTime
        )VALUES {
              #{id},
              #{messageId},
              #{messageKey},
              #{topic},
              #{tag},
              #{message},
              #{status},
              #{times},
              #{nextSendTime}
        }
    </insert>
</mapper>