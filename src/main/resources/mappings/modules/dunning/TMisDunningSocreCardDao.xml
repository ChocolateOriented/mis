<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mo9.risk.modules.dunning.dao.TMisDunningScoreCardDao">
    
	<sql id="TMisDunningScoreCardColumns">
		a.dbid as "dbid",
		a.id as "id",
		a.dealcode as "dealcode",
		a.buyerid as "buyerid",
		a.buyername as "buyername",
		a.mobile as "mobile",
		a.score as "score",
		a.grade as "grade",
		a.createby as "createby",
		a.createdate as "createdate",
		a.updateby as "updateby",
		a.updatedate as "updatedate"
	</sql>
    
	<select id="get" resultType="TMisDunningScoreCard">
		SELECT
			<include refid="TMisDunningScoreCardColumns"/>
		FROM t_mis_dunning_scorecard a
		WHERE a.id = #{id}
	</select>
	
	<select id="findList" resultType="TMisDunningScoreCard">
		SELECT 
			a.dbid as "dbid",
			a.id as "id",
			a.dealcode as "dealcode",
			a.buyerid as "buyerid",
			a.buyername as "buyername",
			a.mobile as "mobile",
			a.score as "score",
			a.grade as "grade",
			a.createby as "createby",
			a.createdate as "createdate",
			a.updateby as "updateby",
			a.updatedate as "updatedate"
		FROM t_mis_dunning_scorecard a
		WHERE a.dealcode = #{dealcode}
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			    ORDER BY a.dbid
			</otherwise>
		</choose>
	</select>
	
	<select id="findAllList" resultType="TMisDunningScoreCard">
		SELECT 
			<include refid="TMisDunningScoreCardColumns"/>
		FROM t_mis_dunning_scorecard a		
		<choose>
			<when test="page !=null and page.orderBy != null and page.orderBy != ''">
				ORDER BY ${page.orderBy}
			</when>
			<otherwise>
			</otherwise>
		</choose>
	</select>
	
	<insert id="insert">
		INSERT INTO t_mis_dunning_scorecard(
			id,
			dealcode,
			buyerid,
			buyername,
			mobile,
			score,
			grade,
			createby,
			createdate,
			updateby,
			updatedate
		) VALUES (
			#{id},
			#{dealcode},
			#{buyerid},
			#{buyername},
			#{mobile},
			#{score},
			#{grade},
			#{createBy.name},
			#{createDate},
			#{updateBy.name},
			#{updateDate}
		)
	</insert>
	
	<update id="update">
		UPDATE t_mis_dunning_scorecard SET
			<if test="score != null">
				score = #{score},
			</if>
			<if test="grade != null">
				grade = #{grade},
			</if>
			updateby = #{updateBy.name},
			updatedate = #{updateDate}
		WHERE id = #{id}
	</update>
	
	<update id="delete">
		DELETE FROM t_mis_dunning_scorecard
		WHERE id = #{id}
	</update>
	
	<select id="getNewRiskOrder" resultType="com.mo9.risk.modules.dunning.entity.DunningOrder">
		SELECT
			o.id as "id",
			o.dealcode as "dealcode",
			o.buyer_id as "buyerid",
			i.real_name as "realname",
			b.mobile as "mobile"
		FROM t_risk_order o
		JOIN t_risk_buyer b on o.buyer_id = b.id
		LEFT JOIN t_risk_buyer_idcard i on i.buyer_id = b.id
		WHERE DATEDIFF(CURDATE(), o.repayment_time)= #{overduedays}
	</select>
	
	<select id="getScoreCardByDealcode" resultType="TMisDunningScoreCard">
		SELECT
			<include refid="TMisDunningScoreCardColumns"/>
		FROM t_mis_dunning_scorecard a
		WHERE dealcode = #{dealcode}
		limit 1
	</select>

</mapper>